<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Juego de Lanzadores - Polinomios C√∫bicos</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: "Segoe UI", sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        h1 {
            margin-bottom: 10px;
        }
        #sliderContainer {
            margin: 20px auto;
        }
        input[type="range"] {
            width: 80%;
        }
        table {
            width: 90%;
            max-width: 1000px;
            margin: 20px auto;
            border-collapse: collapse;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.95rem;
        }
        th, td {
            padding: 8px;
            border-bottom: 1px solid #444;
        }
        tr.winner {
            background: #2e7d32;
            color: #fff;
            font-weight: bold;
        }
        tr:hover {
            background: #333;
        }
        .formula {
            font-size: 0.85rem;
            color: #ccc;
        }
        #graphContainer {
            margin: 20px auto;
            width: 800px;
            max-width: 100%;
        }
        #graph {
            border: 1px solid #555;
            background: #111;
        }
        input.team-x {
            width: 70px;
            text-align: center;
            background: #111;
            color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 2px 4px;
        }
        #graphToggleContainer {
            margin-top: 10px;
        }
        #graphToggleContainer button,
        #launchBtn {
            padding: 6px 12px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #1976d2;
            color: #fff;
            cursor: pointer;
        }
        #graphToggleContainer button:hover,
        #launchBtn:hover {
            background: #1565c0;
        }
        #javelinContainer {
            margin: 30px auto 0;
            width: 900px;
            max-width: 100%;
        }
        #javelin {
            border: 1px solid #555;
            background: #0e1a0e;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>

<h1>üèπ Juego de Lanzadores ‚Äì Polinomios c√∫bicos</h1>
<p>
    Mueve el <b>slider</b> para explorar la fuerza <b>x</b> (si quieres usar la gr√°fica).<br>
    Cada equipo escribe en su casilla el <b>x</b> que ha deducido como mejor y se calcula su distancia.<br>
    Luego pulsa <b>‚ÄúLanzar jabalinas‚Äù</b> para ver la animaci√≥n estilo Hyper Olympics.
</p>

<div id="sliderContainer">
    <label for="force">Fuerza (x): </label>
    <input type="range" id="force" min="0" max="8" step="0.1" value="4">
    <span id="forceValue">4</span>
</div>

<div id="graphToggleContainer">
    <button id="toggleGraphBtn">Ocultar gr√°fica</button>
</div>

<div id="graphContainer">
    <canvas id="graph" width="800" height="400"></canvas>
</div>

<table>
    <thead>
    <tr>
        <th>Equipo</th>
        <th>Polinomio</th>
        <th>Distancia con slider d(x)</th>
        <th>x elegido equipo</th>
        <th>Distancia con x elegido</th>
    </tr>
    </thead>
    <tbody id="results"></tbody>
</table>

<button id="launchBtn">Lanzar jabalinas</button>

<div id="javelinContainer">
    <canvas id="javelin" width="900" height="260"></canvas>
</div>

<script>
    // --- Polinomios c√∫bicos (equilibrados) ---
    const teams = [
        { color: "üü¢", name: "Equipo 1", colorStroke: "#4caf50", formula: x => -0.3*x**3 + 2.5*x**2 + 0.5*x },
        { color: "üîµ", name: "Equipo 2", colorStroke: "#2196f3", formula: x => -0.35*x**3 + 2.5*x**2 + 2*x },
        { color: "üî¥", name: "Equipo 3", colorStroke: "#f44336", formula: x => -0.4*x**3 + 3*x**2 + x },
        { color: "üü°", name: "Equipo 4", colorStroke: "#ffeb3b", formula: x => -0.5*x**3 + 3*x**2 + 3*x },
    ];

    const tbody = document.getElementById("results");
    const forceSlider = document.getElementById("force");
    const forceValue = document.getElementById("forceValue");
    const canvas = document.getElementById("graph");
    const ctx = canvas.getContext("2d");
    const graphContainer = document.getElementById("graphContainer");
    const toggleGraphBtn = document.getElementById("toggleGraphBtn");
    let graphVisible = true;

    const jCanvas = document.getElementById("javelin");
    const jCtx = jCanvas.getContext("2d");

    const xMin = 0, xMax = 8, yMin = 0, yMax = 35, margin = 50;
    let chosenX = [null, null, null, null];

    const lanesY = [60, 120, 180, 240];
    const startX = 80;
    const maxDistanceForScale = 35;
    const endX = jCanvas.width - 80;
    const xScale = (endX - startX) / maxDistanceForScale;
    const arcHeight = 55;

    let javelinStates = teams.map(() => ({
        active: false,
        t: 0,
        startX,
        endX: startX,
        laneY: 0
    }));

    function xToScreen(x) {
        return margin + (x - xMin) * (canvas.width - 2*margin) / (xMax - xMin);
    }

    function yToScreen(y) {
        return canvas.height - margin - (y - yMin) * (canvas.height - 2*margin) / (yMax - yMin);
    }

    function drawAxes() {
        ctx.strokeStyle = "#888";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(xToScreen(xMin), yToScreen(0));
        ctx.lineTo(xToScreen(xMax), yToScreen(0));
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(xToScreen(0), yToScreen(yMin));
        ctx.lineTo(xToScreen(0), yToScreen(yMax));
        ctx.stroke();
        ctx.fillStyle = "#ccc";
        ctx.font = "12px sans-serif";

        for (let x = xMin; x <= xMax; x++) {
            const sx = xToScreen(x);
            const sy = yToScreen(0);
            ctx.moveTo(sx, sy - 4);
            ctx.lineTo(sx, sy + 4);
            ctx.stroke();
            ctx.fillText(x.toString(), sx - 5, sy + 16);
        }
        for (let y = yMin; y <= yMax; y += 5) {
            const sx = xToScreen(0);
            const sy = yToScreen(y);
            ctx.moveTo(sx - 4, sy);
            ctx.lineTo(sx + 4, sy);
            ctx.stroke();
            ctx.fillText(y.toString(), sx - 30, sy + 4);
        }
    }

    function drawCurves(xCurrent) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawAxes();
        teams.forEach(team => {
            ctx.beginPath();
            ctx.lineWidth = 2;
            ctx.strokeStyle = team.colorStroke;
            let first = true;
            for (let x = xMin; x <= xMax; x += 0.05) {
                const y = team.formula(x);
                const sx = xToScreen(x);
                const sy = yToScreen(y);
                if (first) {
                    ctx.moveTo(sx, sy);
                    first = false;
                } else ctx.lineTo(sx, sy);
            }
            ctx.stroke();
            const yCurrent = team.formula(xCurrent);
            ctx.fillStyle = team.colorStroke;
            ctx.beginPath();
            ctx.arc(xToScreen(xCurrent), yToScreen(yCurrent), 4, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    function drawJavelinScene() {
        jCtx.clearRect(0, 0, jCanvas.width, jCanvas.height);
        jCtx.fillStyle = "#123012";
        jCtx.fillRect(0, 0, jCanvas.width, jCanvas.height);

        jCtx.strokeStyle = "#295929";
        jCtx.lineWidth = 1;
        jCtx.font = "11px sans-serif";
        jCtx.fillStyle = "#cce6cc";

        for (let d = 0; d <= maxDistanceForScale; d += 5) {
            const x = startX + d * xScale;
            jCtx.beginPath();
            jCtx.moveTo(x, 30);
            jCtx.lineTo(x, jCanvas.height - 20);
            jCtx.stroke();
            jCtx.fillText(d.toString(), x - 8, 25);
        }

        teams.forEach((team, i) => {
            const laneY = lanesY[i];
            jCtx.strokeStyle = "#3f7a3f";
            jCtx.beginPath();
            jCtx.moveTo(40, laneY + 10);
            jCtx.lineTo(jCanvas.width - 40, laneY + 10);
            jCtx.stroke();
            jCtx.fillStyle = team.colorStroke;
            jCtx.fillRect(startX - 20, laneY - 15, 12, 24);
            jCtx.beginPath();
            jCtx.arc(startX - 14, laneY - 22, 6, 0, Math.PI * 2);
            jCtx.fill();
            jCtx.fillStyle = "#ffffff";
            jCtx.fillText(team.color + " " + team.name, 10, laneY - 25);
        });

        teams.forEach((team, i) => {
            const state = javelinStates[i];
            const laneY = lanesY[i];
            let x, y;
            if (state.t <= 0 || !state.animating) {
                x = startX + 10;
                y = laneY - 5;
            } else {
                const t = state.t;
                x = state.startX + (state.endX - state.startX) * t;
                const baseY = laneY - 5;
                const arc = state.arcHeight;
                const offsetY = arc * (4 * t * (1 - t));
                y = baseY - offsetY;
            }

            jCtx.strokeStyle = "#f5f5f5";
            jCtx.lineWidth = 2;
            jCtx.beginPath();
            jCtx.moveTo(x, y);
            jCtx.lineTo(x + 18, y - 5);
            jCtx.stroke();

            if (state.t > 0) {
                const distNow = Math.max(0, (x - startX) / xScale);
                jCtx.fillStyle = "#ffffff";
                jCtx.font = "11px sans-serif";
                jCtx.fillText(distNow.toFixed(1) + " m", x + 25, y - 5);
            }

            if (!state.animating && state.t > 0) {
                jCtx.fillStyle = team.colorStroke;
                jCtx.beginPath();
                jCtx.arc(state.endX + 18, laneY - 5, 4, 0, Math.PI * 2);
                jCtx.fill();
            }
        });
    }

    function updateTableAndGraph() {
        const x = parseFloat(forceSlider.value);
        forceValue.textContent = x.toFixed(1);
        const results = teams.map(t => ({ ...t, distance: t.formula(x) }));
        const maxDist = Math.max(...results.map(r => r.distance));

        tbody.innerHTML = "";
        results.forEach((r, index) => {
            const tr = document.createElement("tr");
            if (r.distance === maxDist) tr.classList.add("winner");

            let chosen = chosenX[index];
            let chosenDistText = "";
            if (chosen !== null && !isNaN(chosen)) {
                const dChosen = r.formula(chosen);
                chosenDistText = dChosen.toFixed(2);
            }

            tr.innerHTML = `
              <td>${r.color} ${r.name}</td>
              <td class="formula">d(x) = ${r.formula.toString().replace("x => ", "")}</td>
              <td>${r.distance.toFixed(2)}</td>
              <td><input type="number" class="team-x" min="0" max="8" step="0.1" id="chosen-${index}"></td>
              <td>${chosenDistText}</td>`;
            tbody.appendChild(tr);

            const input = tr.querySelector("input.team-x");
            if (chosen !== null && !isNaN(chosen)) input.value = chosen;
            input.addEventListener("input", e => {
                const val = parseFloat(e.target.value);
                chosenX[index] = !isNaN(val) ? val : null;
                updateTableAndGraph();
            });
        });

        if (graphVisible) drawCurves(x);
        drawJavelinScene();
    }

    forceSlider.addEventListener("input", updateTableAndGraph);

    toggleGraphBtn.addEventListener("click", () => {
        graphVisible = !graphVisible;
        graphContainer.style.display = graphVisible ? "block" : "none";
        toggleGraphBtn.textContent = graphVisible ? "Ocultar gr√°fica" : "Mostrar gr√°fica";
        if (graphVisible) drawCurves(parseFloat(forceSlider.value));
    });

    function launchJavelins() {
        let algunoConX = false;
        teams.forEach((team, i) => {
            const x = chosenX[i];
            const state = javelinStates[i];
            if (x !== null && !isNaN(x)) {
                algunoConX = true;
                let dist = team.formula(x);
                dist = Math.min(Math.max(dist, 0), maxDistanceForScale);
                const end = startX + dist * xScale;
                Object.assign(state, { t: 0, startX: startX + 10, endX: end, laneY: lanesY[i], arcHeight, animating: true });
            } else Object.assign(state, { t: 0, animating: false });
        });
        if (!algunoConX) return alert("Ning√∫n equipo ha introducido un valor de x.");
        animateJavelins();
    }

    function animateJavelins() {
        const duration = 140;
        let frame = 0;
        function step() {
            frame++;
            let anyAnimating = false;
            javelinStates.forEach(state => {
                if (state.animating) {
                    anyAnimating = true;
                    state.t = Math.min(1, frame / duration);
                    if (state.t >= 1) state.animating = false;
                }
            });
            drawJavelinScene();
            if (anyAnimating) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
    }

    document.getElementById("launchBtn").addEventListener("click", launchJavelins);
    updateTableAndGraph();
</script>

</body>
</html>
